<div id="form-total">
  <!-- Sección: Información del Proyecto - Compartida -->
  {% include 'forms/components/shared-project-info.html' %}

  <!-- Sección: Documentos y Archivos - Compartida -->
  {% include 'forms/components/shared-documents.html' %}

  <!-- Campos ocultos para mantener compatibilidad con el formulario original -->
  <div style="display: none;">
    <input type="text" id="nombre" name="nombre" />
    <input type="text" id="banco_proyecto" name="banco_proyecto" />
    <input type="text" id="contrato" name="contrato" />
    <input type="file" id="archivo_cad" name="archivo_cad" />
    <input type="file" id="archivo_kmz" name="archivo_kmz" />
  </div>

  <!-- Sección: Información Técnica -->
  <div
    class="bg-white rounded-lg shadow-sm p-8 mb-8"
    id="seccion-informacion-tecnica"
  >
    <h2 class="text-xl font-semibold mb-6 flex items-center text-blue-600">
      <i class="fas fa-bolt mr-2"></i>
      Información Técnica
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="form-group">
        <label class="form-label required">
          FECHA DE INSTALACION
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Fecha en la que se instaló. No puede ser posterior a la fecha
              actual.
            </span>
          </span>
        </label>
        <input
          type="date"
          id="fecha"
          name="fecha"
          class="form-input"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          TIPO DE INVERSION
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Tipo de inversión: I y III requieren estructura retirada, II y IV
              son instalaciones nuevas sin retirar estructura existente.
            </span>
          </span>
        </label>
        <div class="flex items-start gap-4">
          <div class="flex-1">
            <select id="t_inv" name="t_inv" class="form-select" required>
              <option value="">Seleccionar</option>
              <option value="I">I</option>
              <option value="II">II</option>
              <option value="III">III</option>
              <option value="IV">IV</option>
            </select>
          </div>

          <!-- Checkbox Montaje Integral -->
          <div
            class="flex items-center space-x-2"
            id="montaje_integral_container"
            style="display: none"
          >
            <input
              type="checkbox"
              id="montaje_integral_checkbox"
              name="montaje_integral"
              class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"
              onchange="toggleMontajeIntegral()"
            />
            <label
              for="montaje_integral_checkbox"
              class="text-sm text-orange-700 flex items-center gap-1"
            >
              <i class="fas fa-tools text-xs"></i>
              Montaje Integral
            </label>
          </div>

          <!-- Checkbox Desmantelado -->
          <div
            class="flex items-center space-x-2"
            id="desmantelado_container"
            style="display: none"
          >
            <input
              type="checkbox"
              id="desmantelado_checkbox"
              name="desmantelado"
              class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"
              onchange="toggleDesmantelado()"
            />
            <label
              for="desmantelado_checkbox"
              class="text-sm text-red-700 flex items-center gap-1"
            >
              <i class="fas fa-exclamation-triangle text-xs"></i>
              Desmantelado
            </label>
          </div>
        </div>

        <!-- Textos de ayuda -->
        <div class="flex gap-4 mt-1">
          <div class="flex-1"></div>
          <div
            class="text-xs text-gray-500 text-center"
            id="montaje_integral_help"
            style="display: none"
          >
            Deshabilita UC
          </div>
          <div
            class="text-xs text-gray-500 text-center"
            id="desmantelado_help"
            style="display: none"
          >
            Solo estructura retirada
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label required">
          MUNICIPIO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Municipio donde se instalará la estructura. Los municipios
              disponibles dependen de la regional seleccionada.
            </span>
          </span>
        </label>
        <select id="municipio" name="municipio" class="form-select" required>
          <option value="">Seleccionar municipio</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label required">
          DEPARTAMENTO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Departamento donde se encuentra el municipio seleccionado. Se
              autocompletará según el municipio.
            </span>
          </span>
        </label>
        <input
          type="text"
          id="departamento"
          name="departamento"
          class="form-input bg-gray-50"
          placeholder="Se autocompletará según el municipio"
          readonly
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          REGIONAL
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Regional responsable del proyecto. Se autocompletará según el
              contrato o municipio seleccionado.
            </span>
          </span>
        </label>
        <input
          type="text"
          id="regional"
          name="regional"
          class="form-input bg-gray-100 text-gray-500 cursor-not-allowed"
          placeholder="Se autocompletará según contrato o municipio"
          readonly
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">DIRECCIÓN</label>
        <input
          type="text"
          id="direccion"
          name="direccion"
          class="form-input"
          placeholder="Dirección completa"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          CIRCUITO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Circuito eléctrico (alimentador) al que se conecta la estructura.
              Se actualiza automáticamente según el municipio seleccionado.
            </span>
          </span>
        </label>
        <select
          id="alimentador"
          name="alimentador"
          class="form-select"
          required
        >
          <option value="">Seleccionar</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label required">
          ESTRUCTURA RETIRADA
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Código de la estructura que se retira. Solo se habilita para tipos
              de inversión I y III. Debe empezar con "Z" seguido de números.
            </span>
          </span>
        </label>
        <div class="space-y-3">
          <input
            type="text"
            id="estructura_retirada_campo"
            name="estructura_retirada_campo"
            class="form-input bg-yellow-50"
            placeholder="Z10000"
            disabled
          />
        </div>
      </div>

      <!-- Campos de coordenadas -->
      <div class="md:col-span-3">
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
          <div class="form-group">
            <label class="form-label required" id="longitud_label">
              LONGITUD
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Longitud (grados decimales) de la ubicación en
                  Colombia. Rango válido: -79.0 a -66.8 (valores negativos hacia
                  el oeste).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="longitud"
              name="longitud"
              class="form-input"
              placeholder="-74.0721"
              step="0.000001"
              required
              oninput="validateCoordinate(this, 'longitud')"
            />
          </div>

          <div class="form-group">
            <label class="form-label required" id="latitud_label">
              LATITUD
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Latitud (grados decimales) de la ubicación en
                  Colombia. Rango válido: -4.2 a 15.5 (positivo hacia el norte).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="latitud"
              name="latitud"
              class="form-input"
              placeholder="4.7110"
              step="0.000001"
              required
              oninput="validateCoordinate(this, 'latitud')"
            />
          </div>

          <div
            class="form-group"
            id="longitud_final_group"
            style="display: none"
          >
            <label class="form-label" id="longitud_final_label">
              LONGITUD FINAL
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Longitud Final (grados decimales) de la
                  ubicación final en Colombia. Rango válido: -79.0 a -66.8
                  (valores negativos hacia el oeste).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="longitud_final"
              name="longitud_final"
              class="form-input"
              placeholder="-74.0721"
              step="0.000001"
              min="-79.0"
              max="-66.8"
              oninput="validateCoordinate(this, 'longitud')"
            />
          </div>

          <div
            class="form-group"
            id="latitud_final_group"
            style="display: none"
          >
            <label class="form-label" id="latitud_final_label">
              LATITUD FINAL
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Latitud Final (grados decimales) de la ubicación
                  final en Colombia. Rango válido: -4.2 a 15.5 (positivo hacia
                  el norte).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="latitud_final"
              name="latitud_final"
              class="form-input"
              placeholder="4.7110"
              step="0.000001"
              min="-4.2"
              max="15.5"
              oninput="validateCoordinate(this, 'latitud')"
            />
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label required">CANTIDAD TOTAL</label>
        <input
          type="number"
          id="cantidad"
          name="cantidad"
          class="form-input"
          placeholder="1"
          min="1"
          value="1"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">NÚMERO DE CONDUCTORES</label>
        <input
          type="text"
          id="numero_conductores"
          name="numero_conductores"
          class="form-input"
          placeholder="0"
          value="0"
        />
      </div>
    </div>
  </div>
  <!-- Información del Transformador -->
  <div
    class="bg-white rounded-lg shadow-sm p-8 mb-8"
    id="seccion-transformadores"
  >
    <h2 class="text-xl font-semibold mb-6 flex items-center text-blue-600">
      <i class="fas fa-building mr-2"></i>
      Información del Transformador
    </h2>

    <!-- Nuevo Selector UC Jerárquico para Transformadores -->
    <div class="bg-green-50/50 rounded-lg border border-green-200 p-6 mb-6">
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-green-800 mb-4 flex items-center">
          <i class="fas fa-cube mr-2"></i>
          Configuración de Unidad Constructiva del Transformador
        </h3>
        <p class="text-sm text-gray-600 mb-4">
          Utiliza el selector jerárquico para configurar automáticamente todos
          los parámetros del transformador según el tipo de UC seleccionado.
        </p>

        {% include 'forms/components/uc-selector-transformadores.html' %}
      </div>
    </div>

    <!-- Fotos -->
    <div class="mt-6">
      <label class="form-label required">Fotografías</label>
      <div class="flex items-center justify-center w-full">
        <label
          for="fotos"
          class="flex flex-col items-center justify-center w-full h-40 border-2 border-yellow-300 border-dashed rounded-lg cursor-pointer bg-yellow-50 hover:bg-yellow-100 dark:border-yellow-600 dark:hover:border-yellow-500"
        >
          <div class="flex flex-col items-center justify-center pt-5 pb-6">
            <svg
              class="w-8 h-8 mb-4 text-yellow-500"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 20 16"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"
              />
            </svg>
            <p class="mb-2 text-sm text-yellow-600">
              <span class="font-semibold">Click to upload</span> or drag and
              drop
            </p>
            <p class="text-xs text-yellow-500">
              JPG, PNG • Múltiples archivos • Máximo 5MB cada uno
            </p>
          </div>
          <input
            id="fotos"
            name="fotos"
            type="file"
            accept="image/*"
            multiple
            class="hidden"
            required
          />
        </label>
      </div>
      <div
        id="preview_fotos"
        class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 mt-4"
      ></div>
    </div>
  </div>
</div>

<style>
  /* Estilos adicionales para el sistema de autocompletado */
  .form-group select:disabled {
    background-color: #f9fafb;
    color: #9ca3af;
    cursor: not-allowed;
  }

  .form-group select:disabled option {
    color: #9ca3af;
  }

  #resultado_uc .form-input[readonly] {
    background-color: #ecfdf5;
    border-color: #10b981;
    color: #065f46;
    font-weight: 600;
  }

  #mensaje_ayuda {
    transition: all 0.3s ease;
  }

  .tooltip {
    position: relative;
    display: inline-block;
  }

  .tooltip .tooltip-content {
    visibility: hidden;
    width: 300px;
    background-color: #1f2937;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    left: 50%;
    margin-left: -150px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 12px;
    line-height: 1.4;
  }

  .tooltip:hover .tooltip-content {
    visibility: visible;
    opacity: 1;
  }

  .form-label.required::after {
    content: " *";
    color: #ef4444;
    font-weight: bold;
  }

  /* Animaciones para mejor UX */
  .form-group {
    transition: all 0.3s ease;
  }

  .form-group select:focus,
  .form-group input:focus {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Indicadores visuales de progreso */
  .form-group select:valid:not([value=""]) {
    border-color: #10b981;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%2310b981'%3e%3cpath d='M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
  }
</style>
