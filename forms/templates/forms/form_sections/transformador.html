<!-- Sección: TRANSFORMADOR DISTRIBUCIÓN -->
<div class="bg-white rounded-lg shadow-sm p-8 mb-8">
  <h2 class="text-xl font-semibold mb-6 flex items-center text-purple-600">
    <i class="fas fa-microchip mr-2"></i>
    TRANSFORMADOR DE DISTRIBUCIÓN
  </h2>

  <!-- Información del Proyecto -->
  <div class="mb-8">
    <h3 class="text-lg font-semibold mb-4 flex items-center text-blue-600">
      <i class="fas fa-project-diagram mr-2"></i>
      Información del Proyecto
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="form-group">
        <label class="form-label required">
          NOMBRE DEL PROYECTO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Selecciona el proyecto específico para este transformador. Los proyectos disponibles dependen del contrato seleccionado.
            </span>
          </span>
        </label>
        <select id="transformador_nombre_proyecto" name="transformador_nombre_proyecto" class="form-select" required>
          <option value="">Seleccionar proyecto</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">
          BANCO DEL PROYECTO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Código del banco asociado al proyecto. Se autocompletará automáticamente cuando selecciones un proyecto.
            </span>
          </span>
        </label>
        <input
          type="text"
          id="transformador_banco_proyecto"
          name="transformador_banco_proyecto"
          class="form-input bg-gray-50"
          placeholder="Se autocompletará según el proyecto"
          readonly
        />
      </div>
      <div class="form-group">
        <label class="form-label required">
          CONTRATO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Contrato específico del proyecto. Determina qué municipios estarán disponibles según la regional asignada.
            </span>
          </span>
        </label>
        <select id="transformador_contrato" name="transformador_contrato" class="form-select" required>
          <option value="">Seleccionar contrato</option>
          <option value="CNRT-2023-001">CNRT-2023-001</option>
          <option value="CNRT-2023-002">CNRT-2023-002</option>
          <option value="CNRT-2023-003">CNRT-2023-003</option>
          <option value="CNRT-2023-004">CNRT-2023-004</option>
          <option value="CNRT-2023-005">CNRT-2023-005</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Documentos y Archivos -->
  <div class="mb-8">
    <h3 class="text-lg font-semibold mb-4 flex items-center text-blue-600">
      <i class="fas fa-file-alt mr-2"></i>
      Documentos y Archivos
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- AutoCAD -->
      <div class="space-y-4">
        <label class="form-label required">
          Archivo AutoCAD
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Archivo de diseño técnico en formato AutoCAD (.dwg, .dxf, .dws). Debe contener el plano del transformador. Tamaño máximo: 50MB.
            </span>
          </span>
        </label>
        <div class="file-drop-zone border-blue-300 hover:border-blue-500 hover:bg-blue-50/50">
          <input
            type="file"
            id="transformador_archivo_cad"
            name="transformador_archivo_cad"
            class="hidden"
            accept=".dwg,.dxf,.dws"
            required
          />
          <div class="text-center">
            <i class="fas fa-drafting-compass text-2xl text-blue-400 mb-2"></i>
            <p class="text-sm text-gray-600">Cargar archivo AutoCAD</p>
            <p class="text-xs text-gray-500 mt-1">.dwg, .dxf, .dws (máx. 50MB)</p>
          </div>
        </div>
        <!-- Preview AutoCAD -->
        <div id="transformador_cad_preview" class="hidden">
          <div class="flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200">
            <i class="fas fa-file-alt text-gray-400 text-xl mr-3"></i>
            <div class="flex-grow">
              <p class="text-sm font-medium text-gray-900" id="transformador_cad_filename">archivo.dwg</p>
              <p class="text-xs text-gray-500" id="transformador_cad_filesize">2.5 MB</p>
            </div>
            <button
              type="button"
              onclick="removeFile('transformador_archivo_cad')"
              class="text-red-500 hover:text-red-700"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- KMZ -->
      <div class="space-y-4">
        <label class="form-label required">
          Archivo KMZ
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Archivo de geolocalización en formato KMZ de Google Earth. Debe contener las coordenadas exactas del transformador. Tamaño máximo: 10MB.
            </span>
          </span>
        </label>
        <div class="file-drop-zone border-green-300 hover:border-green-500 hover:bg-green-50/50">
          <input
            type="file"
            id="transformador_archivo_kmz"
            name="transformador_archivo_kmz"
            class="hidden"
            accept=".kmz,.kml"
            required
          />
          <div class="text-center">
            <i class="fas fa-globe text-2xl text-green-400 mb-2"></i>
            <p class="text-sm text-gray-600">Cargar archivo KMZ</p>
            <p class="text-xs text-gray-500 mt-1">.kmz, .kml (máx. 10MB)</p>
          </div>
        </div>
        <!-- Preview KMZ -->
        <div id="transformador_kmz_preview" class="hidden">
          <div class="flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200">
            <i class="fas fa-globe text-gray-400 text-xl mr-3"></i>
            <div class="flex-grow">
              <p class="text-sm font-medium text-gray-900" id="transformador_kmz_filename">ubicacion.kmz</p>
              <p class="text-xs text-gray-500" id="transformador_kmz_filesize">0.8 MB</p>
            </div>
            <button
              type="button"
              onclick="removeFile('transformador_archivo_kmz')"
              class="text-red-500 hover:text-red-700"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Información Técnica -->
  <div class="mb-8" id="transformador_seccion-informacion-tecnica">
    <h3 class="text-lg font-semibold mb-4 flex items-center text-blue-600">
      <i class="fas fa-bolt mr-2"></i>
      Información Técnica
    </h3>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="form-group">
        <label class="form-label required">
          FECHA DE INSTALACION
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Fecha en la que se instaló. No puede ser posterior a la fecha actual.
            </span>
          </span>
        </label>
        <input
          type="date"
          id="transformador_fecha"
          name="transformador_fecha"
          class="form-input"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          NIVEL DE TENSIÓN
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Nivel de tensión eléctrica: 1-Baja Tensión (hasta 1kV), 2-Media Tensión (1-35kV), 3-Alta Tensión (mayor a 35kV).
            </span>
          </span>
        </label>
        <select id="transformador_nivel_tension" name="transformador_nivel_tension" class="form-select" required>
          <option value="">Seleccionar</option>
          <option value="1">1 - Baja Tensión</option>
          <option value="2">2 - Media Tensión</option>
          <option value="3">3 - Alta Tensión</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label required">
          TIPO DE INVERSION
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Tipo de inversión: I y III requieren estructura retirada, II y IV son instalaciones nuevas sin retirar estructura existente.
            </span>
          </span>
        </label>
        <div class="flex flex-wrap items-center gap-4">
          <select id="transformador_t_inv" name="transformador_t_inv" class="form-select flex-shrink-0" required>
            <option value="">Seleccionar</option>
            <option value="I">I</option>
            <option value="II">II</option>
            <option value="III">III</option>
            <option value="IV">IV</option>
          </select>
          
          <!-- Montaje Integral Checkbox -->
          <div id="transformador_montaje_integral_container" class="flex items-center gap-2" style="display: none;">
            <input 
              type="checkbox" 
              id="transformador_montaje_integral_checkbox" 
              name="transformador_montaje_integral" 
              class="form-checkbox"
              onchange="toggleMontajeIntegral('transformador')"
            />
            <label for="transformador_montaje_integral_checkbox" class="text-sm font-medium text-gray-700">
              Montaje Integral
            </label>
          </div>
          
          <!-- Desmantelado Checkbox -->
          <div id="transformador_desmantelado_container" class="flex items-center gap-2" style="display: none;">
            <input 
              type="checkbox" 
              id="transformador_desmantelado_checkbox" 
              name="transformador_desmantelado" 
              class="form-checkbox"
              onchange="toggleDesmantelado('transformador')"
            />
            <label for="transformador_desmantelado_checkbox" class="text-sm font-medium text-gray-700">
              Desmantelado
            </label>
          </div>
        </div>
        
        <!-- Help text for Desmantelado -->
        <div id="transformador_desmantelado_help" class="mt-2 text-sm text-gray-600" style="display: none;">
          <i class="fas fa-info-circle text-blue-500"></i>
          Modo desmantelado activo: Se deshabilitarán los campos de coordenadas y se habilitará el campo de estructura retirada.
        </div>
      </div>

      <div class="form-group">
        <label class="form-label required">
          MUNICIPIO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Municipio donde se instalará la estructura. Los municipios disponibles dependen de la regional seleccionada.
            </span>
          </span>
        </label>
        <select id="transformador_municipio" name="transformador_municipio" class="form-select" required>
          <option value="">Seleccionar municipio</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label required">
          DEPARTAMENTO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Departamento donde se encuentra el municipio seleccionado. Se autocompletará según el municipio.
            </span>
          </span>
        </label>
        <input
          type="text"
          id="transformador_departamento"
          name="transformador_departamento"
          class="form-input bg-gray-50"
          placeholder="Se autocompletará según el municipio"
          readonly
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          REGIONAL
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Regional responsable del proyecto. Se autocompletará según el contrato o municipio seleccionado.
            </span>
          </span>
        </label>
        <input 
          type="text" 
          id="transformador_regional" 
          name="transformador_regional" 
          class="form-input bg-gray-100 text-gray-500 cursor-not-allowed" 
          placeholder="Se autocompletará según contrato o municipio"
          readonly
          required>
      </div>

      <div class="form-group">
        <label class="form-label required">DIRECCIÓN</label>
        <input
          type="text"
          id="transformador_direccion"
          name="transformador_direccion"
          class="form-input"
          placeholder="Dirección completa"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          CIRCUITO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Circuito eléctrico (alimentador) al que se conecta la estructura. Se actualiza automáticamente según el municipio seleccionado.
            </span>
          </span>
        </label>
        <select id="transformador_alimentador" name="transformador_alimentador" class="form-select" required>
          <option value="">Seleccionar</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label required">
          ESTRUCTURA RETIRADA
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Código de la estructura que se retira. Solo se habilita para tipos de inversión I y III. Debe empezar con "Z" seguido de números.
            </span>
          </span>
        </label>
        <div class="space-y-3">
          <input
            type="text"
            id="transformador_estructura_retirada_campo"
            name="transformador_estructura_retirada_campo"
            class="form-input bg-yellow-50"
            placeholder="Z10000"
            disabled
          />
        </div>
      </div>

      <!-- Campos de coordenadas -->
      <div class="md:col-span-3">
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
          <div class="form-group">
            <label class="form-label required" id="transformador_longitud_label">
              LONGITUD
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Longitud (grados decimales) de la ubicación en Colombia. Rango válido: -79.0 a -66.8 (valores negativos hacia el oeste).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="transformador_longitud"
              name="transformador_longitud"
              class="form-input"
              placeholder="-74.0721"
              step="0.000001"
              min="-79.0"
              max="-66.8"
              required
              oninput="validateCoordinate(this, 'longitud')"
            />
          </div>

          <div class="form-group">
            <label class="form-label required" id="transformador_latitud_label">
              LATITUD
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Latitud (grados decimales) de la ubicación en Colombia. Rango válido: -4.2 a 15.5 (positivo hacia el norte).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="transformador_latitud"
              name="transformador_latitud"
              class="form-input"
              placeholder="4.7110"
              step="0.000001"
              min="-4.2"
              max="15.5"
              required
              oninput="validateCoordinate(this, 'latitud')"
            />
          </div>

          <div class="form-group" id="transformador_longitud_final_group" style="display: none">
            <label class="form-label" id="transformador_longitud_final_label">
              LONGITUD FINAL
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Longitud Final (grados decimales) de la ubicación final en Colombia. Rango válido: -79.0 a -66.8 (valores negativos hacia el oeste).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="transformador_longitud_final"
              name="transformador_longitud_final"
              class="form-input"
              placeholder="-74.0721"
              step="0.000001"
              min="-79.0"
              max="-66.8"
              oninput="validateCoordinate(this, 'longitud')"
            />
          </div>

          <div class="form-group" id="transformador_latitud_final_group" style="display: none">
            <label class="form-label" id="transformador_latitud_final_label">
              LATITUD FINAL
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Latitud Final (grados decimales) de la ubicación final en Colombia. Rango válido: -4.2 a 15.5 (positivo hacia el norte).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="transformador_latitud_final"
              name="transformador_latitud_final"
              class="form-input"
              placeholder="4.7110"
              step="0.000001"
              min="-4.2"
              max="15.5"
              oninput="validateCoordinate(this, 'latitud')"
            />
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label required">CANTIDAD TOTAL DE ESTRUCTURAS</label>
        <input
          type="number"
          id="transformador_cantidad"
          name="transformador_cantidad"
          class="form-input"
          placeholder="1"
          min="1"
          value="1"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">NÚMERO DE CONDUCTORES</label>
        <input
          type="text"
          id="transformador_numero_conductores"
          name="transformador_numero_conductores"
          class="form-input"
          placeholder="0"
          value="0"
        />
      </div>
    </div>
  </div>

  <!-- Información del Transformador -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="form-group">
      <label class="form-label required">POTENCIA NOMINAL (kVA)</label>
      <select
        id="potencia_transformador"
        name="potencia_transformador"
        class="form-select"
        required
      >
        <option value="">Seleccionar potencia</option>
        <option value="5">5 kVA</option>
        <option value="10">10 kVA</option>
        <option value="15">15 kVA</option>
        <option value="25">25 kVA</option>
        <option value="37.5">37.5 kVA</option>
        <option value="50">50 kVA</option>
        <option value="75">75 kVA</option>
        <option value="100">100 kVA</option>
        <option value="150">150 kVA</option>
        <option value="225">225 kVA</option>
        <option value="300">300 kVA</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label required">TENSIÓN PRIMARIA (kV)</label>
      <select
        id="tension_primaria"
        name="tension_primaria"
        class="form-select"
        required
      >
        <option value="">Seleccionar tensión</option>
        <option value="13.8">13.8 kV</option>
        <option value="34.5">34.5 kV</option>
        <option value="115">115 kV</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label required">TENSIÓN SECUNDARIA (V)</label>
      <select
        id="tension_secundaria"
        name="tension_secundaria"
        class="form-select"
        required
      >
        <option value="">Seleccionar tensión</option>
        <option value="120/240">120/240 V</option>
        <option value="208/120">208/120 V</option>
        <option value="480/277">480/277 V</option>
        <option value="480">480 V</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label required">TIPO DE CONEXIÓN</label>
      <select
        id="tipo_conexion"
        name="tipo_conexion"
        class="form-select"
        required
      >
        <option value="">Seleccionar conexión</option>
        <option value="Monofásico">Monofásico</option>
        <option value="Trifásico Delta-Estrella">Trifásico Delta-Estrella</option>
        <option value="Trifásico Estrella-Estrella">Trifásico Estrella-Estrella</option>
        <option value="Trifásico Delta-Delta">Trifásico Delta-Delta</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label required">MARCA</label>
      <input
        type="text"
        id="marca_transformador"
        name="marca_transformador"
        class="form-input"
        placeholder="ABB, Schneider, General Electric, etc."
        required
      />
    </div>

    <div class="form-group">
      <label class="form-label required">MODELO</label>
      <input
        type="text"
        id="modelo_transformador"
        name="modelo_transformador"
        class="form-input"
        placeholder="Modelo del transformador"
        required
      />
    </div>

    <div class="form-group">
      <label class="form-label required">NÚMERO DE SERIE</label>
      <input
        type="text"
        id="serie_transformador"
        name="serie_transformador"
        class="form-input"
        placeholder="Número de serie"
        required
      />
    </div>

    <div class="form-group">
      <label class="form-label required">AÑO DE FABRICACIÓN</label>
      <input
        type="number"
        id="año_fabricacion"
        name="año_fabricacion"
        class="form-input"
        placeholder="2024"
        min="1980"
        max="2025"
        required
      />
    </div>

    <div class="form-group">
      <label class="form-label required">TIPO DE REFRIGERACIÓN</label>
      <select
        id="refrigeracion"
        name="refrigeracion"
        class="form-select"
        required
      >
        <option value="">Seleccionar tipo</option>
        <option value="ONAN">ONAN (Aceite Natural, Aire Natural)</option>
        <option value="ONAF">ONAF (Aceite Natural, Aire Forzado)</option>
        <option value="Seco">Transformador Seco</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label required">IMPEDANCIA (%)</label>
      <input
        type="number"
        id="impedancia"
        name="impedancia"
        class="form-input"
        placeholder="5.5"
        min="1"
        max="20"
        step="0.1"
        required
      />
    </div>

    <div class="form-group">
      <label class="form-label required">GRUPO DE CONEXIÓN</label>
      <select
        id="grupo_conexion"
        name="grupo_conexion"
        class="form-select"
        required
      >
        <option value="">Seleccionar grupo</option>
        <option value="Dyn1">Dyn1</option>
        <option value="Dyn5">Dyn5</option>
        <option value="Dyn11">Dyn11</option>
        <option value="Yy0">Yy0</option>
        <option value="Dd0">Dd0</option>
      </select>
    </div>

    <div class="form-group md:col-span-3">
      <label class="form-label">OBSERVACIONES</label>
      <textarea
        id="observaciones_transformador"
        name="observaciones_transformador"
        class="form-input"
        rows="3"
        placeholder="Observaciones adicionales sobre el transformador"
      ></textarea>
    </div>
  </div>

  <!-- Fotos del Transformador -->
  <div class="mt-6">
    <label class="form-label required">Fotografías del Transformador</label>
    <div class="file-drop-zone border-purple-300 hover:border-purple-500 hover:bg-purple-50/50">
      <input
        type="file"
        id="fotos_transformador"
        name="fotos_transformador"
        class="hidden"
        accept="image/*"
        multiple
        required
      />
      <div class="text-center">
        <i class="fas fa-camera text-2xl text-purple-400 mb-2"></i>
        <p class="text-sm text-gray-600">
          Arrastra las fotos aquí o haz clic para seleccionar
        </p>
        <p class="text-xs text-gray-500 mt-1">
          Se requiere al menos 1 foto (JPG, PNG, máx. 5MB)
        </p>
      </div>
    </div>
    <div
      id="preview_transformador"
      class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 mt-4"
    ></div>
  </div>
</div>
