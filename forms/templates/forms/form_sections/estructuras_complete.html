<!-- Wrapper del formulario completo -->
<div id="form-total">
  <!-- Sección: Información del Proyecto - Compartida -->
  {% include 'forms/components/shared-project-info.html' %}

  <!-- Sección: Documentos y Archivos - Compartida -->
  {% include 'forms/components/shared-documents.html' %}

  <!-- Campos ocultos para mantener compatibilidad con el formulario original -->
  <div style="display: none">
    <input type="text" id="nombre" name="nombre" />
    <input type="text" id="banco_proyecto" name="banco_proyecto" />
    <input type="text" id="contrato" name="contrato" />
    <input type="file" id="archivo_cad" name="archivo_cad" />
    <input type="file" id="archivo_kmz" name="archivo_kmz" />
  </div>

  <!-- Sección: Información Técnica -->
  <div
    class="bg-white rounded-lg shadow-sm p-8 mb-8"
    id="seccion-informacion-tecnica"
  >
    <h2 class="text-xl font-semibold mb-6 flex items-center text-blue-600">
      <i class="fas fa-bolt mr-2"></i>
      Información Técnica
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="form-group">
        <label class="form-label required">
          FECHA DE INSTALACION
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Fecha en la que se instaló. No puede ser posterior a la fecha
              actual.
            </span>
          </span>
        </label>
        <input
          type="date"
          id="fecha"
          name="fecha"
          class="form-input"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          TIPO DE INVERSION
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Tipo de inversión: I y III requieren estructura retirada, II y IV
              son instalaciones nuevas sin retirar estructura existente.
            </span>
          </span>
        </label>
        <div class="flex items-start gap-4">
          <div class="flex-1">
            <select
              id="t_inv"
              name="t_inv"
              class="form-select"
              required
              onchange="handleTipoInversion()"
            >
              <option value="">Seleccionar</option>
              <option value="I">I</option>
              <option value="II">II</option>
              <option value="III">III</option>
              <option value="IV">IV</option>
            </select>
          </div>

          <!-- Checkbox Montaje Integral -->
          <div
            class="flex items-center space-x-2"
            id="montaje_integral_container"
          >
            <input
              type="checkbox"
              id="montaje_integral_checkbox"
              name="montaje_integral"
              class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"
              onchange="toggleMontajeIntegral()"
            />
            <label
              for="montaje_integral_checkbox"
              class="text-sm text-orange-700 flex items-center gap-1"
            >
              <i class="fas fa-tools text-xs"></i>
              Montaje Integral
            </label>
          </div>
        </div>

        <!-- Texto de ayuda solo para Montaje Integral -->
        <div class="flex gap-4 mt-1">
          <div class="flex-1"></div>
          <div
            class="text-xs text-gray-500 text-center"
            id="montaje_integral_help"
            style="display: none"
          >
            Deshabilita campos UC
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label required">
          MUNICIPIO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Municipio donde se instalará la estructura. Los municipios
              disponibles dependen de la regional seleccionada.
            </span>
          </span>
        </label>
        <select id="municipio" name="municipio" class="form-select" required>
          <option value="">Seleccionar municipio</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label required">
          DEPARTAMENTO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Departamento donde se encuentra el municipio seleccionado. Se
              autocompletará según el municipio.
            </span>
          </span>
        </label>
        <input
          type="text"
          id="departamento"
          name="departamento"
          class="form-input bg-gray-50"
          placeholder="Se autocompletará según el municipio"
          readonly
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          REGIONAL
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Regional responsable del proyecto. Se autocompletará según el
              contrato o municipio seleccionado.
            </span>
          </span>
        </label>
        <input
          type="text"
          id="regional"
          name="regional"
          class="form-input bg-gray-100 text-gray-500 cursor-not-allowed"
          placeholder="Se autocompletará según contrato o municipio"
          readonly
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">DIRECCIÓN</label>
        <input
          type="text"
          id="direccion"
          name="direccion"
          class="form-input"
          placeholder="Dirección completa"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label required">
          CIRCUITO
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Circuito eléctrico (alimentador) al que se conecta la estructura.
              Se actualiza automáticamente según el municipio seleccionado.
            </span>
          </span>
        </label>
        <select
          id="alimentador"
          name="alimentador"
          class="form-select"
          required
        >
          <option value="">Seleccionar</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label required" for="estructura_retirada_campo">
          ESTRUCTURA RETIRADA
          <span class="tooltip">
            <i class="fas fa-question-circle help-icon"></i>
            <span class="tooltip-content">
              Código de la estructura que se retira. Solo se habilita para tipos
              de inversión I y III. Debe empezar con "Z" seguido de números.
            </span>
          </span>
        </label>

        <div class="flex items-start gap-4">
          <!-- Campo de entrada -->
          <div class="flex-1">
            <input
              type="text"
              id="estructura_retirada_campo"
              name="estructura_retirada_campo"
              class="form-input bg-white"
              placeholder="Z10000"
            />
          </div>

          <!-- Checkbox Desmantelado junto al campo -->
          <div
            class="flex items-center space-x-2"
            id="desmantelado_container"
            style="display: none"
          >
            <input
              type="checkbox"
              id="desmantelado_checkbox"
              name="desmantelado"
              class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"
              onchange="toggleDesmantelado()"
            />
            <label
              for="desmantelado_checkbox"
              class="text-sm text-red-700 flex items-center gap-1 whitespace-nowrap"
            >
              <i class="fas fa-exclamation-triangle text-xs"></i>
              Desmantelado
            </label>
          </div>
        </div>

        <!-- Texto de ayuda para desmantelado -->
        <div class="mt-1">
          <div
            class="text-xs text-gray-500 text-center"
            id="desmantelado_help"
            style="display: none"
          >
            Solo habilita: Información del proyecto, Documentos/archivos y
            Estructura retirada
          </div>
        </div>
      </div>

      <!-- Campos de coordenadas -->
      <div class="md:col-span-3">
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
          <div class="form-group">
            <label class="form-label required" id="longitud_label">
              LONGITUD
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Longitud (grados decimales) de la ubicación en
                  Colombia. Rango válido: -79.0 a -66.8 (valores negativos hacia
                  el oeste).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="longitud"
              name="longitud"
              class="form-input"
              placeholder="-74.0721"
              step="0.000001"
              required
              oninput="validateCoordinate(this, 'longitud')"
            />
          </div>

          <div class="form-group">
            <label class="form-label required" id="latitud_label">
              LATITUD
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Latitud (grados decimales) de la ubicación en
                  Colombia. Rango válido: -4.2 a 15.5 (positivo hacia el norte).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="latitud"
              name="latitud"
              class="form-input"
              placeholder="4.7110"
              step="0.000001"
              required
              oninput="validateCoordinate(this, 'latitud')"
            />
          </div>

          <div
            class="form-group"
            id="longitud_final_group"
            style="display: none"
          >
            <label class="form-label" id="longitud_final_label">
              LONGITUD FINAL
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Longitud Final (grados decimales) de la
                  ubicación final en Colombia. Rango válido: -79.0 a -66.8
                  (valores negativos hacia el oeste).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="longitud_final"
              name="longitud_final"
              class="form-input"
              placeholder="-74.0721"
              step="0.000001"
              min="-79.0"
              max="-66.8"
              oninput="validateCoordinate(this, 'longitud')"
            />
          </div>

          <div
            class="form-group"
            id="latitud_final_group"
            style="display: none"
          >
            <label class="form-label" id="latitud_final_label">
              LATITUD FINAL
              <span class="tooltip">
                <i class="fas fa-question-circle help-icon"></i>
                <span class="tooltip-content">
                  Coordenada de Latitud Final (grados decimales) de la ubicación
                  final en Colombia. Rango válido: -4.2 a 15.5 (positivo hacia
                  el norte).
                </span>
              </span>
            </label>
            <input
              type="number"
              id="latitud_final"
              name="latitud_final"
              class="form-input"
              placeholder="4.7110"
              step="0.000001"
              min="-4.2"
              max="15.5"
              oninput="validateCoordinate(this, 'latitud')"
            />
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">CANTIDAD TOTAL</label>
        <input
          type="number"
          id="cantidad"
          name="cantidad"
          class="form-input bg-gray-100 text-gray-600 cursor-not-allowed"
          value="1"
          readonly
          disabled
        />
        <small class="text-xs text-gray-500 mt-1"
          >Valor fijo para estructuras</small
        >
      </div>

      <div class="form-group">
        <label class="form-label">NÚMERO DE CONDUCTORES</label>
        <input
          type="text"
          id="numero_conductores"
          name="numero_conductores"
          class="form-input bg-gray-100 text-gray-600 cursor-not-allowed"
          value="0"
          readonly
          disabled
        />
        <small class="text-xs text-gray-500 mt-1"
          >Valor fijo para estructuras</small
        >
      </div>
    </div>
  </div>

  <!-- Sección: Información de Estructuras -->
  <div
    class="bg-white rounded-lg shadow-sm p-8 mb-8"
    id="seccion-informacion-estructuras"
  >
    <h2 class="text-xl font-semibold mb-6 flex items-center text-blue-600">
      <i class="fas fa-building mr-2"></i>
      Información de Estructuras
    </h2>

    <!-- Contenedor de campos de estructuras -->
    <div id="form-uc">
      <!-- Estructura Nueva - Solo Selector UC Jerárquico -->
      <div
        class="bg-emerald-50/50 rounded-lg border border-emerald-200 p-6 mb-6"
      >
        <!-- Selector UC Jerárquico Integrado -->
        <div class="mb-6">
          <h3
            class="text-lg font-semibold text-emerald-800 mb-4 flex items-center"
          >
            <i class="fas fa-cube mr-2"></i>
            Configuración de Unidad Constructiva
          </h3>
          <p class="text-sm text-gray-600 mb-4">
            Utiliza el selector jerárquico para configurar automáticamente todos
            los parámetros de la estructura según el tipo de UC seleccionado.
          </p>

          <!-- El selector UC jerárquico reemplaza todos los campos individuales -->
          {% include 'forms/components/uc-selector-estructuras.html' %}
        </div>

        <!-- Fotos -->
        <div class="mt-6">
          <label class="form-label required">Fotografías</label>
          <div class="flex items-center justify-center w-full">
            <label
              for="fotos"
              class="flex flex-col items-center justify-center w-full h-40 border-2 border-yellow-300 border-dashed rounded-lg cursor-pointer bg-green-50 hover:bg-green-100 dark:border-green-600 dark:hover:border-green-500"
            >
              <div class="flex flex-col items-center justify-center pt-5 pb-6">
                <svg
                  class="w-8 h-8 mb-4 text-green-500"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 20 16"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"
                  />
                </svg>
                <p class="mb-2 text-sm text-green-600">
                  <span class="font-semibold">Click para subir</span> o arrastra
                  y suelta
                </p>
                <p class="text-xs text-green-500">
                  JPG, PNG • Múltiples archivos • Máximo 5MB cada uno
                </p>
              </div>
              <input
                id="fotos"
                name="fotos"
                type="file"
                accept="image/*"
                multiple
                class="hidden"
              />
            </label>
          </div>
          <div
            id="preview"
            class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 mt-4"
          ></div>
        </div>
      </div>
      <!-- Fin contenedor form-uc -->
    </div>
  </div>
  <!-- Fin del wrapper del formulario completo -->

  <form id="formEstructuras" method="post" enctype="multipart/form-data">
    <!-- ...todos los campos del formulario... -->
    <input type="hidden" id="iteraciones_json" name="iteraciones_json" />
    <!-- ...botón de envío... -->
  </form>

  <!-- JavaScript inline removido - ahora usa sistema-funcionalidades-compartidas.js -->
  
  <!-- Scripts específicos para estructuras -->
  <script>
    // Configuración específica para la sección de estructuras
    function initEstructurasSpecific() {
      // Inicializando funcionalidades específicas de estructuras
      
      // Cualquier lógica específica solo para estructuras puede ir aquí
      // El resto ahora lo maneja el sistema compartido
      
      // Estructuras específicas inicializadas
    }
  </script>

  <!-- Scripts compartidos se cargan desde base_seccion.html -->
</div>
